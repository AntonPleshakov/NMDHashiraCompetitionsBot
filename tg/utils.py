from textwrap import dedent
from typing import Union, Tuple, List

from telebot.types import InlineKeyboardButton, KeyboardButton, Message, CallbackQuery

from db.admins import admins_db
from db.ratings import Rating
from db.tournament_structures import Match, TournamentSettings, RegistrationRow


def get_permissions_denied_message(user_id: int):
    admins_list = [
        f"[{admin.username}](tg://user?id={admin.user_id})"
        for admin in admins_db.get_admins()
    ]
    return (
        "Ð’Ñ‹ Ð½Ðµ ÑÐ²Ð»ÑÐµÑ‚ÐµÑÑŒ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼\.\n"
        + "Ð’Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÑÑ‚Ð²Ð¸Ðµ Ñ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ð¾Ð¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½Ð½Ñ‹Ñ… Ñ‡Ð°Ñ‚Ð°Ñ…\.\n"
        + "Ð”Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ð¾Ð¹ Ñ‡Ð°ÑÑ‚Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ðº Ð¾Ð´Ð½Ð¾Ð¼Ñƒ Ð¸Ð· Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð² Ñ Ð²Ð°ÑˆÐ¸Ð¼ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð¾Ð¼\.\n"
        + f"Ð’Ð°Ñˆ ID\: {user_id}\n"
        + "Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²\: "
        + "\, ".join(admins_list)
    )


def get_right_suffix(value: int, word_without_suffix: str) -> str:
    if value % 10 == 1 and value % 100 != 11:
        return word_without_suffix
    elif 2 <= value % 10 <= 4 and not 12 <= value % 100 <= 14:
        return word_without_suffix + "Ð°"
    else:
        return word_without_suffix + "Ð¾Ð²"


def get_tournament_welcome_message(
    settings: TournamentSettings, tournament_url: str
) -> str:
    registration_hours = settings.registration_duration_hours.value
    tour_hours = settings.round_duration_hours.value
    tours = settings.rounds_number.value
    return dedent(
        f"""
        *Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ\! Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ\! Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ\!*
        ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽ, Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹!

        Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð° Ð½Ð¾Ð²Ñ‹Ð¹ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€, Ð³Ð´Ðµ Ð²Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¸ Ð½Ð°Ð²Ñ‹ÐºÐ¸ Ð¸ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸ÑŽ Ð² Ð±Ð¸Ñ‚Ð²Ð°Ñ….
        Ð¡Ð¾Ñ€ÐµÐ²Ð½Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð²Ð¾Ð´Ð¸Ñ‚ÑÑ Ð¿Ð¾ ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ ÐœÐ°Ðº-ÐœÐ°Ð³Ð¾Ð½Ð° Ð² {tours} {get_right_suffix(tours, "Ñ‚ÑƒÑ€")}
        ÐŸÐ¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ð¼ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ð° Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð²ÑÐµÑ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð±ÑƒÐ´ÐµÑ‚ Ð¿ÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ð°Ð½ Ð¿Ð¾ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ðµ Ð­Ð»Ð¾ Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¸Ñ.
        Ð’Ñ€ÐµÐ¼Ñ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¾ â€“ Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð²ÑÐµÐ³Ð¾ {registration_hours} {get_right_suffix(registration_hours, "Ñ‡Ð°Ñ")}, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð·Ð°ÑÐ²Ð¸Ñ‚ÑŒ Ð¾ ÑÐ²Ð¾ÐµÐ¼ ÑƒÑ‡Ð°ÑÑ‚Ð¸Ð¸. â³

        ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ‚ÑƒÑ€ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð»Ð¸Ñ‚ÑŒÑÑ {tour_hours} {get_right_suffix(tour_hours, "Ñ‡Ð°Ñ")}.
        Ð’Ð°Ð¼ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð¾Ð¸Ñ‚ ÑÐ°Ð¼Ð¾ÑÑ‚Ð¾ÑÑ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð¾Ð³Ð¾Ð²Ð°Ñ€Ð¸Ð²Ð°Ñ‚ÑŒÑÑ Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð±Ð¸Ñ‚Ð²Ñ‹ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ñƒ Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ñ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ð½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ñ Ð±ÑƒÐ´Ñƒ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ñ‚ÑŒ Ð² ÑÑ‚Ð¾Ð¼ Ñ‡Ð°Ñ‚Ðµ.

        ðŸ“¥ Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð° Ñ‚ÑƒÑ€Ð½Ð¸Ñ€ Ð¼Ð¾Ð¶Ð½Ð¾, Ð½Ð°Ð¶Ð°Ð² Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð¿Ð¾Ð´ ÑÑ‚Ð¸Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÐµÐ¼.

        ÐŸÐ¾ÑÐ»Ðµ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ñ ÑÐ²ÑÐ¶ÑƒÑÑŒ Ñ Ð²Ð°Ð¼Ð¸ Ð»Ð¸Ñ‡Ð½Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚ÑŒ Ð²Ð°Ñˆ Ð½Ð¸Ðº Ð² Ð¸Ð³Ñ€Ðµ, ÐµÑÐ»Ð¸ Ð¾Ð½ Ð¼Ð½Ðµ ÐµÑ‰Ðµ Ð½Ðµ Ð¸Ð·Ð²ÐµÑÑ‚ÐµÐ½.

        Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð±Ð¸Ñ‚Ð² Ð¼Ð¾Ð¶Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÐµÐ¼ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ñ‚ÑƒÑ€Ð°.
        Ð’ÑÑ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ðµ, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ ÑÐ¿Ð¸ÑÐ¾Ðº Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð²ÑˆÐ¸Ñ…ÑÑ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð², Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ð½Ñ‹Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹, Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð¿Ð¾ ÑÑ‚Ð¾Ð¹ ÑÑÑ‹Ð»ÐºÐµ: {tournament_url}

        Ð•ÑÐ»Ð¸ Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ¸ Ðº Ð±Ð¸Ñ‚Ð²Ðµ Ð¸Ð»Ð¸ Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ð° Ñƒ Ð²Ð°Ñ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ½ÑƒÑ‚ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¸Ð»Ð¸ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹, Ð¿Ñ€Ð¾ÑˆÑƒ Ð²Ð°Ñ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚ÑŒ Ð¾Ð± ÑÑ‚Ð¾Ð¼ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°Ð¼.
        ÐŸÐ¾Ð¼Ð½Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾ Ð¿ÐµÑ€Ð²Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ¸, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚Ð¸.

        Ð¡Ñ‡Ð°ÑÑ‚Ð»Ð¸Ð²Ñ‹Ñ… Ð²Ð°Ð¼ Ð³Ð¾Ð»Ð¾Ð´Ð½Ñ‹Ñ… Ð¸Ð³Ñ€\.
        Ð˜ Ð¿ÑƒÑÑ‚ÑŒ ÑƒÐ´Ð°Ñ‡Ð° Ð²ÑÐµÐ³Ð´Ð° Ð±ÑƒÐ´ÐµÑ‚ Ñ Ð²Ð°Ð¼Ð¸\.
        """
    )


def get_next_tour_message(
    settings: TournamentSettings,
    pairs: List[Match],
    tours_number: int,
    tournament_url: str,
) -> str:
    tour_hours = settings.round_duration_hours.value
    pairs_str = ""
    for match in pairs:
        first = f"[{match.first.value}](tg://user?id={match.first_id})"
        second = f"[{match.second.value}](tg://user?id={match.second_id})"
        pairs_str += f"{first} vs {second}"
    return dedent(
        f"""
        Ð’Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ, Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹!

        ÐÐ°ÑÑ‚Ð°Ð»Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ {tours_number} Ñ‚ÑƒÑ€Ð° Ð½Ð°ÑˆÐµÐ³Ð¾ Ð·Ð°Ñ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‰ÐµÐ³Ð¾ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ð°.
        ÐŸÑ€Ð¸ÑˆÐ»Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÐ²Ð¾ÑŽ ÑÐ¸Ð»Ñƒ Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€ÑÑ‚Ð²Ð¾ Ð½Ð° Ð°Ñ€ÐµÐ½Ðµ!

        Ð£ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ {tour_hours} {get_right_suffix(tour_hours, "Ñ‡Ð°Ñ")} Ð½Ð° Ð¿Ñ€Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð±Ð¸Ñ‚Ð²Ñ‹.
        Ð”Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÐµÑÑŒ Ñ ÑÐ¾Ð¿ÐµÑ€Ð½Ð¸ÐºÐ¾Ð¼ Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð¸ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÐºÐ°Ñ€Ñ‚Ñƒ Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ð¸ ÑÐ¾ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¹ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ð½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†ÐµÐ¹:
        {pairs_str}
        Ð’ÑÑ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð¿Ð¾ ÑÑ‚Ð¾Ð¹ ÑÑÑ‹Ð»ÐºÐµ: {tournament_url}

        ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð±Ð¸Ñ‚Ð²Ñ‹ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚, Ð½Ð°Ð¶Ð°Ð² Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð¿Ð¾Ð´ ÑÑ‚Ð¸Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÐµÐ¼.
        ÐŸÑƒÑÑ‚ÑŒ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ñ…Ð¾Ð´ Ð¿Ñ€Ð¸Ð±Ð»Ð¸Ð¶Ð°ÐµÑ‚ Ð²Ð°Ñ Ðº Ð¿Ð¾Ð±ÐµÐ´Ðµ Ð¸ ÑÐ»Ð°Ð²Ðµ!

        ÐŸÐ¾Ð¼Ð½Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²ÑÐµ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ°ÑŽÑ‰Ð¸Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð½ÐµÐ·Ð°Ð¼ÐµÐ´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð¾Ð²ÐµÐ´ÐµÐ½Ñ‹ Ð´Ð¾ ÑÐ²ÐµÐ´ÐµÐ½Ð¸Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð².
        Ð­Ñ‚Ð¾Ñ‚ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€ â€“ Ð¸ÑÐ¿Ñ‹Ñ‚Ð°Ð½Ð¸Ðµ Ð´Ð»Ñ Ð²ÑÐµÑ… Ð½Ð°Ñ, Ð½Ð¾ Ð¼Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÐµÑÑŒ.

        ÐŸÑƒÑÑ‚ÑŒ ÑƒÐ´Ð°Ñ‡Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð½Ð° Ð²Ð°ÑˆÐµÐ¹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ! Ð”Ð° Ð½Ð°Ñ‡Ð½ÐµÑ‚ÑÑ Ð±Ð¸Ñ‚Ð²Ð°! ðŸŽ®ðŸ†
        """
    )


def get_tournament_end_message(winners: List[str], tournament_url: str) -> str:
    places = ["ðŸ¥‡ ÐŸÐµÑ€Ð²Ð¾Ðµ", "ðŸ¥ˆ Ð’Ñ‚Ð¾Ñ€Ð¾Ðµ", "ðŸ¥‰ Ð¢Ñ€ÐµÑ‚ÑŒÐµ"]
    winners_str = ""
    for i, winner in enumerate(winners):
        if i > len(places):
            break
        winners_str += places[i] + " Ð¼ÐµÑÑ‚Ð¾: " + winner + "\n"
    return dedent(
        f"""
        Ð¢Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹!

        ÐÐ°Ñˆ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€ Ð¿Ð¾Ð´Ð¾ÑˆÐµÐ» Ðº ÐºÐ¾Ð½Ñ†Ñƒ.
        Ð’Ñ‹ Ð²ÑÐµ Ð¿Ñ€Ð¾ÑÐ²Ð¸Ð»Ð¸ Ð½ÐµÐ²ÐµÑ€Ð¾ÑÑ‚Ð½ÑƒÑŽ ÑÐ¸Ð»Ñƒ, ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸ÑŽ Ð¸ Ð²Ð¾Ð»ÑŽ Ðº Ð¿Ð¾Ð±ÐµÐ´Ðµ.
        ÐŸÑ€Ð¸ÑˆÐ»Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð±ÑŠÑÐ²Ð¸Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¸ Ñ‡ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°ÑˆÐ¸Ñ… Ñ‡ÐµÐ¼Ð¿Ð¸Ð¾Ð½Ð¾Ð².

        {winners_str}

        Ð’Ñ‹ Ð¿Ð¾ÐºÐ°Ð·Ð°Ð»Ð¸ Ð²Ñ‹ÑÑˆÐ¸Ð¹ ÐºÐ»Ð°ÑÑ Ð² ÑÑ‚Ð¾Ð¼ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ðµ, Ð¸ Ð²Ð°ÑˆÐ¸ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ Ð½Ð°Ð²ÑÐµÐ³Ð´Ð° Ð¾ÑÑ‚Ð°Ð½ÑƒÑ‚ÑÑ Ð² Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ð½Ð°ÑˆÐ¸Ñ… Ð±Ð¸Ñ‚Ð².
        Ð’ÑÑ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ñ… Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð¿Ð¾ ÑÑ‚Ð¾Ð¹ ÑÑÑ‹Ð»ÐºÐµ: {tournament_url}

        ÐœÑ‹ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð¸Ð¼ Ð²ÑÐµÑ… ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² Ð·Ð° Ð¸Ñ… ÑƒÑÐµÑ€Ð´Ð¸Ðµ Ð¸ Ð±Ð¾ÐµÐ²Ð¾Ð¹ Ð´ÑƒÑ….
        Ð•ÑÐ»Ð¸ Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ ÐºÐ°ÐºÐ¸Ðµ-Ð»Ð¸Ð±Ð¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¸Ð»Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, Ð½Ðµ ÑÑ‚ÐµÑÐ½ÑÐ¹Ñ‚ÐµÑÑŒ Ð¾Ð±Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒÑÑ Ðº Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°Ð¼.

        ÐŸÑƒÑÑ‚ÑŒ ÑƒÐ´Ð°Ñ‡Ð° Ð²ÑÐµÐ³Ð´Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð½Ð° Ð²Ð°ÑˆÐµÐ¹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ, Ð¸ Ð´Ð¾ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð¸ Ð½Ð° ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ðµ! ðŸŽ®ðŸ†

        Ð¡ ÑƒÐ²Ð°Ð¶ÐµÐ½Ð¸ÐµÐ¼,
        ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ð°
        """
    )


def get_ids(message: Union[Message, CallbackQuery]) -> Tuple[int, int, int]:
    user_id = message.from_user.id
    if isinstance(message, CallbackQuery):
        message = message.message
    chat_id = message.chat.id
    message_id = message.id
    return user_id, chat_id, message_id


def get_user_view(message: Union[Message, CallbackQuery]) -> str:
    user = message.from_user
    return f"{user.first_name} {user.last_name}({user.username})"


def get_player_rating_view(player: Union[RegistrationRow, Rating]) -> str:
    return f"{player.tg_username.value}({player.nmd_username.value}): {player.rating.value}"


class Button:
    def __init__(self, descr: str, data: str = ""):
        self.data = data
        self.descr = descr

    def inline(self):
        return InlineKeyboardButton(text=self.descr, callback_data=self.data)

    def reply(self):
        return KeyboardButton(text=self.descr)


def empty_filter(_):
    return True
